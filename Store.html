<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Store — Nikita Kotrelev</title>
  <meta name="description" content="Fine-art prints by Nikita Kotrelev. Ships worldwide." />
  <link rel="icon" href="img/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/img/favicon_180x180.png" sizes="180x180">
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#0b0b0b">

  <style>
    :root{
      --bg:#f5f5f5;
      --fg:#0b0b0b;
      --muted:#6b7280;
      --card:#ffffff;
      --border:#e7e7e7;
      --shadow:0 18px 40px rgba(0,0,0,.08);

      --safe-top:max(env(safe-area-inset-top),0px);
      --safe-bot:max(env(safe-area-inset-bottom),0px);
      --header-h:64px;
    }

    @font-face{
      font-family:'Afacad Flux';
      src: local('Afacad Flux Regular'),
           url('fonts/AfacadFlux-Regular.woff2') format('woff2'),
           url('fonts/AfacadFlux-Regular.woff') format('woff');
      font-weight:400; font-style:normal; font-display:swap;
    }

    html,body{height:100%}
    html{color-scheme:light}

    body{
      margin:0;
      font-family:'Afacad Flux',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,'Noto Sans',sans-serif;
      background:var(--bg);
      color:var(--fg);
      min-height:100dvh;
      display:grid;
      grid-template-rows:auto 1fr auto;
      -webkit-tap-highlight-color:transparent;
    }

    /* ===== Header ===== */
    header{
      position:fixed; top:0; left:0; right:0; z-index:60;
      padding-top:var(--safe-top); height:var(--header-h);
      backdrop-filter:saturate(180%) blur(10px);
      background:rgba(245,245,245,.82);
      border-bottom:1px solid var(--border);
      box-sizing:border-box;
    }
    .nav{
      max-width:1320px; margin:0 auto; padding:12px 24px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      box-sizing:border-box;
    }
    .brand{
      font-weight:700;
      letter-spacing:.12em;
      text-decoration:none;
      color:var(--fg);
      white-space:nowrap;
      flex:0 0 auto;
      font-size:13px;
      text-transform:uppercase;
    }
    .links{
      display:flex; gap:10px; align-items:center;
      overflow-x:auto; overscroll-behavior-inline:contain;
      scrollbar-width:none;
      max-width:100%;
    }
    .links::-webkit-scrollbar{display:none}
    .links a{
      color:var(--fg);
      text-decoration:none;
      opacity:.85;
      padding:8px 12px;
      border-radius:999px;
      white-space:nowrap;
      font-size:14px;
      flex:0 0 auto;
    }
    .links a:hover{opacity:1;background:rgba(0,0,0,.04)}
    .links a[aria-current="page"]{background:rgba(0,0,0,.06);opacity:1}

    /* ===== Hero ===== */
    .page-hero{
      padding-top:calc(var(--header-h) + 64px);
      padding-bottom:28px;
      max-width:1320px;
      margin:0 auto;
      padding-inline:24px;
      box-sizing:border-box;
    }
    .page-hero h1{
      font-size:clamp(30px,4vw,52px);
      margin:0 0 10px;
      line-height:1.05;
      letter-spacing:-.02em;
    }
    .page-hero p{
      color:var(--muted);
      font-size:clamp(14px,1.8vw,18px);
      margin:0;
      max-width:70ch;
      line-height:1.5;
    }

    /* ===== Store grid ===== */
    .store{
      max-width:1320px;
      margin:0 auto 72px;
      padding:0 24px;
      display:grid;
      gap:26px;
      grid-template-columns:repeat(3, minmax(0,1fr));
      align-items:start;
      box-sizing:border-box;
    }

    .product{
      display:flex;
      flex-direction:column;
      gap:14px;
      background:transparent;
    }

    .tile{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:0;
      padding:22px 22px 28px;
      min-height:520px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      position:relative;
      box-shadow:0 10px 24px rgba(0,0,0,.06);
      transition:transform .25s ease, box-shadow .25s ease;
      overflow:hidden;
    }
    .tile:hover{
      transform:translateY(-4px);
      box-shadow:var(--shadow);
    }

    .meta{
      font-weight:800;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
      color:var(--fg);
      opacity:.9;
      margin-bottom:12px;
    }

    .thumb{
      margin-top:10px;
      flex:1;
      display:grid;
      place-items:center;
      cursor:pointer;
      position:relative;
    }

    .mat{
      position:relative;
      width:min(92%, 420px);
      background:transparent;  /* ✅ убрали белый лист */
      border:0;                /* ✅ убрали рамку паспарту */
      box-shadow:none;         /* ✅ убрали тень у паспарту */
      padding:0;               /* ✅ убрали паспарту */
      box-sizing:border-box;
      display:grid;
      place-items:center;
      overflow:hidden;         /* оставляем, чтобы autotrim не вылезал */
    }

    .mat::after{
      content:"";
      position:absolute;
      inset:0;
      border:0px solid transparent;   /* ✅ тонкая рамка, не “паспарту” */
      transition:border-color .18s ease;
      pointer-events:none;
      z-index:2;
    }
    .thumb:hover .mat::after{
      border-color:#0b0b0b;           /* ✅ появляется чёрная рамка при наведении */
    }

    .thumb img{
      width:100%;
      height:auto;
      max-height:320px;
      object-fit:contain;
      display:block;
      transition:transform .5s ease;
    }
    .thumb:hover img{ transform:scale(1.02); }

    /* ✅ Auto-trim transforms */
    .autotrim{
      transform-origin:50% 50%;
      will-change:transform;
    }

    .quick{
      position:absolute;
      left:0; right:0;
      bottom:-56px;
      height:56px;

      display:flex;
      align-items:center;
      justify-content:center;

      font-weight:800;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:13px;

      background:#ffffff;
      border:0;
      border-top:1px solid var(--border);

      transition:bottom .22s ease;
      cursor:pointer;
      pointer-events:auto;
    }
    .tile:hover .quick{ bottom:0; }

    .caption{
      padding:2px 2px 0;
      display:grid;
      gap:6px;
    }
    .name{
      margin:0;
      font-size:15px;
      font-weight:600;
      line-height:1.25;
      color:var(--fg);
    }
    .priceLine{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .price{
      font-size:16px;
      font-weight:600;
      letter-spacing:.01em;
      color:var(--fg);
    }

    /* ===== Lightbox ===== */
    .lightbox{
      position:fixed; inset:0;
      background:rgba(0,0,0,.92);
      display:none; z-index:80;
    }
    .lightbox[aria-hidden="false"]{display:grid}
    .lightbox__inner{
      display:grid;
      grid-template-rows:1fr auto;
      width:100%;
      height:100%;
    }
    .lightbox__image-wrap{
      display:grid;
      place-items:center;
      padding:24px;
      box-sizing:border-box;
      width:100%;
    }
    .lightbox__img{
      display:block;
      margin:auto;
      max-width:100%;
      max-height:86vh;
      width:auto;
      height:auto;
      object-fit:contain;
      cursor:pointer;
    }
    .lightbox__caption{
      padding:12px 24px 24px;
      display:flex; gap:16px; align-items:center; justify-content:space-between;
      color:rgba(255,255,255,.75);
      padding-bottom: calc(24px + var(--safe-bot));
      box-sizing:border-box;
    }
    .lightbox__caption strong{color:#fff; font-weight:600}

    /* ===== Quick View Modal ===== */
    .qv{
      position:fixed;
      inset:0;
      display:none;
      z-index:90;
      background:rgba(0,0,0,.45);
      padding:24px;
      box-sizing:border-box;
    }
    .qv[aria-hidden="false"]{display:grid; place-items:center;}

    .qv__panel{
      width:min(1040px, 100%);
      background:#fff;
      border:1px solid var(--border);
      box-shadow:0 30px 80px rgba(0,0,0,.18);
      position:relative;
      box-sizing:border-box;
      overflow:hidden;
    }

    .qv__close{
      position:absolute;
      top:14px;
      right:14px;
      width:40px;
      height:40px;
      border:2px solid #111;
      background:#fff;
      border-radius:0;
      cursor:pointer;
      font-size:18px;
      line-height:1;
      z-index:2;
    }

    .qv__nav{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:44px;
      height:44px;
      border:1px solid rgba(0,0,0,.25);
      background:#fff;
      border-radius:0;
      cursor:pointer;
      z-index:2;
      display:grid;
      place-items:center;
      font-size:22px;
      line-height:1;
    }
    .qv__nav--prev{left:14px;}
    .qv__nav--next{right:14px;}
    .qv__nav[disabled]{opacity:.35; cursor:not-allowed;}

    .qv__grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:0;
      min-height:640px;
    }

    .qv__media{
      padding:0;
      border-right:1px solid var(--border);
      display:grid;
      grid-template-columns:1fr;
      gap:0;
      align-items:stretch;
      background:#fff;
      position:relative;
    }

    /* мини-превью скрыты */
    .qv__thumbs{ display:none !important; }

    .qv__mat{
      width:100%;
      padding:0;
      background:transparent;
      border:0;
      box-shadow:none;
      display:grid;
      place-items:center;
    }

    .qv__mat img{
      width:80%;
      height:80%;
      max-height:540px;
      object-fit:contain;
      display:block;

      /* тень только у фото */
      filter:
        drop-shadow(0 10px 22px rgba(0,0,0,.22))
        drop-shadow(0 10px 16px rgba(0,0,0,.38));
    }

    /* ✅ плавная смена картинки в quick view */
    #qv-img{
      opacity:1;
      transition: opacity .22s ease;
      will-change: opacity;
    }
    #qv-img.is-switching{ opacity:0; }

    /* ✅ МЕНЬШЕ ТОЛЬКО ДЛЯ Unframed (работает через qv.dataset.finish) */
    #qv[data-finish="unframed"] .qv__mat img{
      width:65%;
      height:auto;
      max-height:480px;
    }
    #qv[data-finish="unframed"] .qv__mat{ padding:24px 0; }

    .qv__info{
      padding:26px 28px 26px;
      display:flex;
      flex-direction:column;
    }

    .qv__meta{
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
      opacity:.9;
      margin-bottom:10px;
    }
    .qv__title{
      margin:0 0 10px;
      font-size:44px;
      line-height:1.02;
      letter-spacing:-.02em;
      font-weight:900;
    }
    .qv__price{
      font-weight:600;
      font-size:18px;
      margin-bottom:14px;
    }
    .qv__note{
      margin:0 0 18px;
      color:#111;
      font-size:14px;
      line-height:1.45;
    }
    .qv__note u{text-underline-offset:3px;}

    .qv__field{
      display:grid;
      gap:10px;
      margin-top:8px;
      margin-bottom:18px;
    }
    .qv__label{
      font-size:16px;
      font-weight:600;
      color:#111;
    }
    .qv__size-fixed{
      width:fit-content;
      max-width:100%;
      padding:14px 16px;
      border:2px solid #111;
      border-radius:0;
      background:#fff;
      font:inherit;
      min-width:280px;
    }

    .qv__finish{
      margin-top:6px;
      border-top:1px solid var(--border);
      padding-top:16px;
      margin-bottom:14px;
    }
    .qv__finish-row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .qv__finish-title{
      font-size:18px;
      font-weight:700;
      color:#111;
    }
    .qv__finish-title span{
      font-weight:500;
      color:var(--muted);
    }
    .qv__swatches{
      display:flex;
      gap:12px;
      margin-top:12px;
      align-items:center;
    }
    .qv__sw{
      width:56px;
      height:56px;
      border-radius:999px;
      border:2px solid rgba(0,0,0,.15);
      background:#fff;
      cursor:pointer;
      display:grid;
      place-items:center;
      position:relative;
      opacity:.95;
    }
    .qv__sw[aria-current="true"]{
      border-color:#111;
      box-shadow:0 10px 18px rgba(0,0,0,.12);
    }
    .qv__corner{
      width:28px;
      height:28px;
      border-left:5px solid #111;
      border-top:5px solid #111;
      transform:translate(2px,2px);
    }
    .qv__sw--white .qv__corner{border-color:#d9d9d9;}
    .qv__sw--black .qv__corner{border-color:#111;}
    .qv__sw--unframed .qv__corner{
      border-left:4px solid #d9d9d9;
      border-top:4px solid #d9d9d9;
    }

    .qv__actions{
      display:grid;
      gap:12px;
      margin-top:auto;
      padding-top:10px;
      border-top:1px solid var(--border);
    }
    .qv__btn{
      width:100%;
      appearance:none;
      border:2px solid #111;
      background:#fff;
      color:#111;
      padding:16px 18px;
      border-radius:0;
      font-weight:800;
      letter-spacing:.02em;
      text-transform:none;
      font-size:18px;
      cursor:pointer;
    }
    .qv__btn--primary{
      background:#4b2ae6;
      color:#fff;
      border-color:#4b2ae6;
    }
    .qv__btn[disabled]{opacity:.5; cursor:not-allowed;}

    .qv__details{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:12px;
      font-weight:900;
      letter-spacing:.02em;
      text-transform:uppercase;
      font-size:14px;
      color:#111;
      text-decoration:none;
      width:fit-content;
      border-bottom:2px solid #111;
      padding-bottom:4px;
    }

    @media(max-width:980px){
      .qv__title{font-size:32px;}
    }
    @media(max-width:820px){
      .qv{padding:12px;}
      .qv__grid{grid-template-columns:1fr; min-height:auto;}
      .qv__media{
        border-right:none;
        border-bottom:1px solid var(--border);
        grid-template-columns:1fr;
      }
      .qv__nav{display:none;}
      .qv__title{font-size:28px;}
      .qv__btn{font-size:16px;}
    }

    /* ===== Footer ===== */
    footer{
      border-top:1px solid var(--border);
      color:var(--muted);
      padding:24px;
      padding-bottom: calc(24px + var(--safe-bot));
      box-sizing:border-box;
      background:var(--bg);
    }
    footer .row{
      max-width:1320px;margin:0 auto;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:0 24px;
      box-sizing:border-box;
    }

    /* ===== Responsive ===== */
    @media(max-width:1100px){
      .store{grid-template-columns:repeat(2, minmax(0,1fr));}
      .tile{min-height:500px;}
    }
    @media(max-width:740px){
      .store{grid-template-columns:1fr;}
      .tile{min-height:460px;}
      .mat{width:min(94%, 520px); padding:22px;}
      .thumb img{max-height:300px;}
    }

    @media(max-width:640px){
      :root{--header-h:auto;}
      header{
        position: sticky;
        height:auto;
        padding-bottom: 10px;
      }
      .nav{
        padding:12px 12px;
        flex-direction: column;
        align-items:flex-start;
        gap:10px;
      }
      .brand{font-size:12px;}
      .links{
        width:100%;
        flex-wrap:wrap;
        overflow:visible;
        gap:8px;
      }
      .links a{font-size:14px; padding:10px 12px;}
      .page-hero{
        padding-top: 18px;
        padding-inline:12px;
        text-align:left;
      }
      .page-hero h1{font-size:34px; line-height:1.05;}
      .page-hero p{font-size:14px; line-height:1.45;}
      .store{padding:0 12px; margin-bottom:40px;}
      footer .row{flex-direction:column; align-items:flex-start; padding:0 12px;}
      footer{padding:20px 12px calc(20px + var(--safe-bot));}
    }

    @media (prefers-reduced-motion: reduce){
      .tile:hover{transform:none}
      .thumb:hover img{transform:none}
      .quick{transition:none}
      .mat::after{transition:none}
      #qv-img{transition:none}
    }
  </style>
</head>

<body>
  <header>
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="index.html">NIKITA KOTRELEV</a>
      <div class="links" role="navigation" aria-label="Primary links">
        <a href="Video.html">Video</a>
        <a href="Photos.html">Photos</a>
        <a href="Projects.html">Projects</a>
        <a href="About me.html">About</a>
        <a href="Store.html" aria-current="page">Store</a>
      </div>
    </nav>
  </header>

  <div class="page-hero">
    <h1>Store</h1>
    <p>Fine-art prints — printed by me, signed & numbered. Worldwide shipping.</p>
  </div>

  <section class="store" id="store" aria-label="Store products">

    <!-- ✅ SIZE HERE (меняешь значение в data-size) -->
    <article class="product" data-product="brittany" data-size="36×26 cm in (40 × 30 cm)"><!-- ✅ SIZE HERE -->
      <div class="tile">
        <div class="meta">NIKITA KOTRELEV</div>

        <div class="thumb"
             data-lightbox="img/Биританни без  рамы .png"
             data-caption="France, Brittany">
          <div class="mat">
            <img data-autotrim="1" src="img/Биританни без  рамы .png" alt="France, Brittany print" loading="lazy" decoding="async">
          </div>
        </div>

        <button class="quick" type="button" data-qv>QUICK VIEW</button>
      </div>

      <div class="caption">
        <p class="name">Poster: France, Brittany</p>
        <div class="priceLine">
          <span class="price" data-price>€—</span>
        </div>
      </div>
    </article>

    <!-- ✅ SIZE HERE (меняешь значение в data-size) -->
    <article class="product" data-product="oleron" data-size="36×26 cm in (40 × 30 cm)"><!-- ✅ SIZE HERE -->
      <div class="tile">
        <div class="meta">NIKITA KOTRELEV</div>

        <div class="thumb"
             data-lightbox="img/Олерон без рамы .png"
             data-caption="Oléron Island">
          <div class="mat">
            <img data-autotrim="1" src="img/Олерон без рамы .png" alt="Oléron Island print" loading="lazy" decoding="async">
          </div>
        </div>

        <button class="quick" type="button" data-qv>QUICK VIEW</button>
      </div>

      <div class="caption">
        <p class="name"> Poster: Oléron Island</p>
        <div class="priceLine">
          <span class="price" data-price>€—</span>
        </div>
      </div>
    </article>

    <!-- ✅ SIZE HERE (меняешь значение в data-size) -->
    <article class="product" data-product="Morocco" data-size="36×24 cm in (40 × 30 cm)"><!-- ✅ SIZE HERE -->
      <div class="tile">
        <div class="meta">NIKITA KOTRELEV</div>

        <div class="thumb"
             data-lightbox="img/Марроко без рамы .png"
             data-caption="Morocco, Road">
          <div class="mat">
            <img data-autotrim="1" src="img/Марроко без рамы .png" alt="Morocco, Road print" loading="lazy" decoding="async">
          </div>
        </div>

        <button class="quick" type="button" data-qv>QUICK VIEW</button>
      </div>

      <div class="caption">
        <p class="name"> Poster: Morocco, Road</p>
        <div class="priceLine">
          <span class="price" data-price>€—</span>
        </div>
      </div>
    </article>

  </section>

  <!-- ===== LIGHTBOX ===== -->
  <div class="lightbox" id="lightbox" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="lightbox__inner">
      <div class="lightbox__image-wrap">
        <img id="lb-img" class="lightbox__img" alt="">
      </div>
      <div class="lightbox__caption">
        <span><strong id="lb-cap"></strong></span>
        <span>Preview</span>
      </div>
    </div>
  </div>

  <!-- ===== QUICK VIEW MODAL ===== -->
  <div class="qv" id="qv" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="qv__panel" role="document">
      <button class="qv__close" type="button" id="qv-close" aria-label="Close">×</button>

    

      <div class="qv__grid">
        <div class="qv__media">
          <div class="qv__thumbs" id="qv-thumbs" aria-label="Thumbnails"></div>
          <div class="qv__mat">
            <img id="qv-img" data-autotrim="1" alt="">
          </div>
        </div>

        <div class="qv__info">
          <div class="qv__meta" id="qv-meta">NIKITA KOTRELEV</div>
          <h2 class="qv__title" id="qv-title"></h2>
          <div class="qv__price" id="qv-price">€—</div>

          <p class="qv__note">Tax included. <u>Shipping</u> calculated at checkout.</p>

          <!-- ✅ SIZE OUTPUT (сюда JS подставит data-size) -->
          <div class="qv__field">
            <div class="qv__label">Size:</div>
            <div class="qv__size-fixed" id="qv-size-text">—</div><!-- ✅ SIZE OUTPUT -->
          </div>

          <div class="qv__finish" id="qv-finish">
            <div class="qv__finish-row">
              <div class="qv__finish-title">Select finish: <span id="qv-finish-label">Unframed</span></div>
            </div>
            <div class="qv__swatches" id="qv-swatches"></div>
          </div>

          <div class="qv__actions">
            <button class="qv__btn qv__btn--primary" type="button" id="qv-buy">Buy with Shop</button>
          </div>

          <a class="qv__details" id="qv-details" href="#" target="_self" rel="noopener">FULL DETAILS ›</a>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="row">
      <span>© <span id="year"></span> Nikita Kotrelev</span>
      <span>Payments powered by Stripe</span>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    function euro(n){
      if (typeof n !== "number") return "€—";
      return "€" + n.toFixed(0);
    }

    function euroRangeFromFinishes(productId){
      const info = PRODUCT_INFO?.[productId];
      const prices = (info?.finishes || [])
        .map(f => Number(f.price))
        .filter(n => Number.isFinite(n));

      if (!prices.length) return "€—";
      const min = Math.min(...prices);
      const max = Math.max(...prices);
      return (min === max) ? euro(min) : `${euro(min)}–${euro(max)}`;
    }

    // ==========================
    // PRODUCT DATA + STRIPE URLS
    // ==========================
    // ВСТАВЬ ССЫЛКИ STRIPE В url ДЛЯ КАЖДОГО finish
    const PRODUCT_INFO = {
      brittany: {
        meta: "NIKITA KOTRELEV",
        title: "France, Brittany",
        detailsHref: "Store.html#brittany",
        finishes: [
          {
            key:"unframed",
            label:"Unframed",
            price:70,
            url:"https://buy.stripe.com/dRm9AM2QI28B7St1giasg0b",
            images:["img/Биританни без  рамы .png"]
          },
          {
            key:"black",
            label:"Custom Black Frame",
            price:300,
            url:"https://buy.stripe.com/8x26oA3UM5kNgoZ0ceasg0c",
            images:["img/Биританни Черная  рама .png","img/Биританни Черная  рама .png"]
          },
          {
            key:"white",
            label:"Custom White Frame",
            price:300,
            url:"https://buy.stripe.com/14A6oAezq7sV7St8IKasg0d",
            images:["img/Биританни белая рама .png","img/Биританни белая рама .png"]
          }
        ]
      },

      oleron: {
        meta: "NIKITA KOTRELEV",
        title: "Oléron Island",
        detailsHref: "Store.html#oleron",
        finishes: [
          {
            key:"unframed",
            label:"Unframed",
            price:70,
            url:"https://buy.stripe.com/5kQ3co9f64gJ6Op9MOasg08",
            images:["img/Олерон без рамы .png"]
          },
          {
            key:"black",
            label:"Custom Black Frame",
            price:300,
            url:"https://buy.stripe.com/28EcMY4YQ7sV7St1giasg09",
            images:["img/Олерон черная рама .png","img/Олерон черная рама .png"]
          },
          {
            key:"white",
            label:"Custom White Frame",
            price:300,
            url:"https://buy.stripe.com/7sYeV6ezqeVn3Cd9MOasg0a",
            images:["img/Олерон белая рама .png","img/Олерон белая рама .png"]
          }
        ]
      },

      Morocco: {
        meta: "NIKITA KOTRELEV",
        title: "Morocco, Road",
        detailsHref: "Store.html#Morocco",
        finishes: [
          {
            key:"unframed",
            label:"Unframed",
            price:70,
            url:"https://buy.stripe.com/9B6fZabne4gJc8J0ceasg05",
            images:["img/Марроко без рамы .png"]
          },
          {
            key:"black",
            label:"Custom Black Frame",
            price:300,
            url:"https://buy.stripe.com/28EdR28b25kN1u51giasg06",
            images:["img/Маррокочернаярама.png","img/Маррокочернаярама.png"]
          },
          {
            key:"white",
            label:"Custom White Frame",
            price:300,
            url:"https://buy.stripe.com/00w3co8b2eVngoZ6ACasg07",
            images:["img/Маррокобелаярама.png","img/Маррокобелаярама.png"]
          }
        ]
      }
    };

    // ==========================
    // CARD PRICES
    // ==========================
    document.querySelectorAll('.product').forEach((card)=>{
      const productId = card.dataset.product;
      const priceEl = card.querySelector('[data-price]');

      // ✅ диапазон 70–300
      if (priceEl){
        priceEl.textContent = euroRangeFromFinishes(productId);
      }
    });

    // ===== Lightbox preview (клик по картинке) =====
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lb-img');
    const lbCap = document.getElementById('lb-cap');

    function openLb(src, cap){
      lbImg.src = src;
      lbImg.alt = cap || "Preview";
      lbCap.textContent = cap || "";
      lb.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeLb(){
      lb.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      lbImg.src = "";
    }

    document.addEventListener('click', (e)=>{
      const t = e.target.closest('.thumb');
      if(!t) return;
      openLb(t.dataset.lightbox || t.querySelector('img')?.src, t.dataset.caption || "");
    });

    lbImg.addEventListener('click', (e)=>{ e.stopPropagation(); closeLb(); });
    lb.addEventListener('click', (e)=>{ if(e.target === lb) closeLb(); });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeLb(); });

    // ===== Quick View Modal =====
    const qv = document.getElementById('qv');
    const qvImg = document.getElementById('qv-img');
    const qvMeta = document.getElementById('qv-meta');
    const qvTitle = document.getElementById('qv-title');
    const qvPrice = document.getElementById('qv-price');
    const qvBuy = document.getElementById('qv-buy');
    const qvClose = document.getElementById('qv-close');
   
    const qvThumbs = document.getElementById('qv-thumbs');
    const qvDetails = document.getElementById('qv-details');
    const qvSwatches = document.getElementById('qv-swatches');
    const qvFinishLabel = document.getElementById('qv-finish-label');

    // ✅ NEW: размер в Quick View
    const qvSizeText = document.getElementById('qv-size-text'); // ✅ SIZE OUTPUT

    const productOrder = Array.from(document.querySelectorAll('.product')).map(p => p.dataset.product);
    let currentProductIndex = 0;
    let currentImageIndex = 0;
    let currentFinishKey = "unframed";

    function getCurrentId(){ return productOrder[currentProductIndex]; }
    function getInfo(id){ return PRODUCT_INFO?.[id] || {}; }

    // ✅ получить size из карточки по productId
    function getSizeForProduct(productId){
      const card = document.querySelector(`.product[data-product="${CSS.escape(productId)}"]`);
      return card?.dataset?.size || "";
    }

    // ✅ цена зависит только от finish
    function euroFromFinish(id){
      const info = getInfo(id);
      const fin = (info.finishes || []).find(f => f.key === currentFinishKey);
      return (typeof fin?.price === "number") ? fin.price : null;
    }

    // ✅ плавная смена картинки (fade + preload)
    let qvSwapToken = 0;
    function setQVImage(src){
      const token = ++qvSwapToken;

      if(!src){
        qvImg.classList.remove("is-switching");
        qvImg.src = "";
        qvImg.alt = qvTitle.textContent || "Preview";
        return;
      }

      qvImg.classList.add("is-switching");

      const pre = new Image();
      pre.decoding = "async";
      pre.src = src;

      const commit = () => {
        if(token !== qvSwapToken) return;

        qvImg.src = src;
        qvImg.alt = qvTitle.textContent || "Preview";

        // автотрим после подмены
        enableAutoTrimIn(qv);

        requestAnimationFrame(()=> {
          requestAnimationFrame(()=> qvImg.classList.remove("is-switching"));
        });
      };

      if (pre.complete) commit();
      else pre.onload = commit;
    }

    function renderThumbs(images){
      // миниатюрки скрыты CSS-ом, но оставляем на будущее
      qvThumbs.innerHTML = "";
      images.forEach((src, i)=>{
        if(!src) return;
        const b = document.createElement('button');
        b.type = "button";
        b.className = "qv__t";
        b.setAttribute('aria-current', i === currentImageIndex ? "true" : "false");
        b.innerHTML = `<img data-autotrim="1" src="${src}" alt="">`;
        b.addEventListener('click', ()=>{
          currentImageIndex = i;
          setQVImage(images[currentImageIndex]);
          renderThumbs(images);
        });
        qvThumbs.appendChild(b);
        enableAutoTrimIn(b);
      });
    }

    function renderSwatches(id){
      const info = getInfo(id);
      const finishes = info.finishes || [];

      qvSwatches.innerHTML = "";
      finishes.forEach((f)=>{
        const b = document.createElement('button');
        b.type = "button";

        let cls = "qv__sw";
        if (f.key === "white") cls += " qv__sw--white";
        if (f.key === "black") cls += " qv__sw--black";
        if (f.key === "unframed") cls += " qv__sw--unframed";
        b.className = cls;

        b.setAttribute('aria-current', f.key === currentFinishKey ? "true" : "false");
        b.innerHTML = `<div class="qv__corner"></div>`;
        b.addEventListener('click', ()=>{
          currentFinishKey = f.key;
          currentImageIndex = 0;
          applyFinish(id);
          renderSwatches(id);
        });
        qvSwatches.appendChild(b);
      });
    }

    function applyFinish(id){
      const info = getInfo(id);
      const fin = (info.finishes || []).find(f => f.key === currentFinishKey) || info.finishes?.[0];
      const images = (fin?.images && fin.images.length) ? fin.images.filter(Boolean) : [];

      // ✅ чтобы CSS уменьшал Unframed
      qv.dataset.finish = currentFinishKey;

      qvFinishLabel.textContent = fin?.label || "Unframed";

      renderThumbs(images);
      setQVImage(images[currentImageIndex] || "");

      const p = euroFromFinish(id);
      qvPrice.textContent = (typeof p === "number") ? euro(p) : "€—";

      // ✅ STRIPE URL ТОЛЬКО ДЛЯ ВЫБРАННОГО FINISH
      const url = fin?.url || "";
      qvBuy.disabled = !url || url.includes("PASTE_STRIPE_");
      qvBuy.dataset.url = url;

      enableAutoTrimIn(qv);
    }

    function updateArrows(){
      qvPrev.disabled = (currentProductIndex <= 0);
      qvNext.disabled = (currentProductIndex >= productOrder.length - 1);
    }

    function openQVById(productId){
      currentProductIndex = Math.max(0, productOrder.indexOf(productId));
      currentImageIndex = 0;
      currentFinishKey = "unframed";

      const info = getInfo(productId);
      qvMeta.textContent = info.meta || "NIKITA KOTRELEV";
      qvTitle.textContent = info.title || productId;

      // ✅ NEW: подставляем размер из data-size
      qvSizeText.textContent = getSizeForProduct(productId) || "—";

      renderSwatches(productId);

      qvDetails.href = info.detailsHref || `Store.html#${productId}`;

      qv.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';

      applyFinish(productId);
      updateArrows();

      enableAutoTrimIn(document);
    }

    function closeQV(){
      qv.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      qvImg.src = "";
      qvThumbs.innerHTML = "";
      qvSwatches.innerHTML = "";
      delete qv.dataset.finish;
    }

    function goPrev(){
      if(currentProductIndex <= 0) return;
      const id = productOrder[currentProductIndex - 1];
      openQVById(id);
    }
    function goNext(){
      if(currentProductIndex >= productOrder.length - 1) return;
      const id = productOrder[currentProductIndex + 1];
      openQVById(id);
    }

    // open quick view (кнопка QUICK VIEW)
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-qv]');
      if(!btn) return;
      const card = btn.closest('.product');
      if(!card) return;
      openQVById(card.dataset.product);
    });

   

    

    // close
    qvClose.addEventListener('click', closeQV);
    qv.addEventListener('click', (e)=>{ if(e.target === qv) closeQV(); });

    // buy
    qvBuy.addEventListener('click', ()=>{
      const url = qvBuy.dataset.url;
      if(!url) return;
      window.location.href = url;
    });

    // =======================
    // AUTO-TRIM WHITE MARGINS
    // =======================
    const TRIM_CACHE = new Map();
    const WHITE_T = 248;

    function isWhite(r,g,b,a){
      if (a < 10) return true;
      return r >= WHITE_T && g >= WHITE_T && b >= WHITE_T;
    }

    function computeTrimFromImage(imgEl){
      const src = imgEl.currentSrc || imgEl.src;
      if(!src) return;

      if (TRIM_CACHE.has(src)){
        const t = TRIM_CACHE.get(src);
        imgEl.classList.add("autotrim");
        imgEl.style.transform = `translate(${t.tx}%, ${t.ty}%) scale(${t.scale})`;
        return;
      }

      const probe = new Image();
      probe.decoding = "async";
      probe.onload = () => {
        const w = probe.naturalWidth;
        const h = probe.naturalHeight;

        const maxSide = 420;
        const s = Math.min(1, maxSide / Math.max(w, h));
        const cw = Math.max(1, Math.round(w * s));
        const ch = Math.max(1, Math.round(h * s));

        const c = document.createElement("canvas");
        c.width = cw; c.height = ch;
        const ctx = c.getContext("2d", { willReadFrequently:true });
        ctx.drawImage(probe, 0, 0, cw, ch);

        const { data } = ctx.getImageData(0, 0, cw, ch);

        let minX = cw, minY = ch, maxX = 0, maxY = 0;
        let found = false;

        for (let y=0; y<ch; y++){
          for (let x=0; x<cw; x++){
            const i = (y*cw + x) * 4;
            const r = data[i], g = data[i+1], b = data[i+2], a = data[i+3];
            if (!isWhite(r,g,b,a)){
              found = true;
              if (x < minX) minX = x;
              if (y < minY) minY = y;
              if (x > maxX) maxX = x;
              if (y > maxY) maxY = y;
            }
          }
        }

        if (!found){
          TRIM_CACHE.set(src, { tx:0, ty:0, scale:1 });
          imgEl.classList.add("autotrim");
          imgEl.style.transform = `translate(0%, 0%) scale(1)`;
          return;
        }

        const boxW = (maxX - minX + 1);
        const boxH = (maxY - minY + 1);
        const rW = boxW / cw;
        const rH = boxH / ch;

        let scale = 1 / Math.max(rW, rH);
        scale = Math.min(scale, 1.35);

        const cx = (minX + maxX) / 2 / cw;
        const cy = (minY + maxY) / 2 / ch;
        const tx = (0.5 - cx) * 100;
        const ty = (0.5 - cy) * 100;

        const t = { tx, ty, scale };
        TRIM_CACHE.set(src, t);

        imgEl.classList.add("autotrim");
        imgEl.style.transform = `translate(${tx}%, ${ty}%) scale(${scale})`;
      };

      probe.src = src;
    }

    function enableAutoTrimIn(root=document){
      root.querySelectorAll('img[data-autotrim="1"]').forEach(img=>{
        img.classList.add("autotrim");
        if (img.complete) computeTrimFromImage(img);
        else img.addEventListener("load", ()=>computeTrimFromImage(img), { once:true });
      });
    }

    enableAutoTrimIn(document);
  </script>
</body>
</html>
